- name: Push join script to /tmp/k8s-join.sh on each worker
  copy:
    src: ./k8s-join.sh
    dest: /tmp/k8s-join.sh
    mode: '0755'
  retries: 30
  delay: 5

- name: "Join the node to cluster"
  shell: /tmp/k8s-join.sh 2>&1 | tee /tmp/k8s-join.log
  register: join_command_result
  until: join_command_result.rc == 0
  retries: 30
  delay: 5

- name: "Display join command output"
  debug:
    msg: "{{ join_command_result.stdout_lines }}"
